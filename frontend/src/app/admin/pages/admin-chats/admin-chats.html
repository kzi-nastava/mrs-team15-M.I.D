<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <app-page-header title="User Chats" description="View and manage conversations with users"></app-page-header>

      <div class="d-flex justify-content-between align-items-center mb-3 gap-3">
        <div class="input-group flex-grow-1" style="max-width: 400px;">
          <span class="input-group-text bg-white">
            <i class="bi bi-search"></i>
          </span>
          <input
            type="text"
            class="form-control"
            placeholder="Search by user name or chat ID..."
            [(ngModel)]="searchTerm"
          >
        </div>
        <button class="btn btn-outline-dark" (click)="loadChats()" [disabled]="loading">
          <i class="bi bi-arrow-clockwise me-2"></i>
          {{ loading ? 'Loading...' : 'Refresh' }}
        </button>
      </div>

      <div *ngIf="error" class="alert alert-danger d-flex align-items-center mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ error }}
      </div>

      <div *ngIf="loading" class="d-flex flex-column align-items-center py-5">
        <div class="spinner-border text-dark mb-3" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted">Loading chats...</p>
      </div>

      <div *ngIf="!loading && chats.length === 0" class="text-center py-5">
        <i class="bi bi-chat-dots" style="font-size: 3rem; color: #6c757d;"></i>
        <p class="text-muted mt-3">No chats available.</p>
      </div>

      <div *ngIf="!loading && chats.length > 0 && filteredChats.length === 0" class="text-center py-5">
        <i class="bi bi-search" style="font-size: 3rem; color: #6c757d;"></i>
        <p class="text-muted mt-3">No chats found matching "{{ searchTerm }}".</p>
      </div>

      <div *ngIf="!loading && filteredChats.length > 0" class="list-group">
        <div
          *ngFor="let chat of filteredChats"
          [class.chat-with-new-messages]="chat.hasNewMessages"
          class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
          (click)="openChat(chat.id)"
          style="cursor: pointer;"
        >
          <div class="flex-grow-1">
            <div class="d-flex align-items-center gap-2">
              <h6 class="mb-0 fw-semibold">Chat #{{ chat.id }}</h6>
              <span *ngIf="chat.hasNewMessages" class="badge bg-black text-white">New</span>
            </div>
            <p class="mb-0 text-muted small mt-1">{{ chat.user }}</p>
          </div>
          <i class="bi bi-chevron-right"></i>
        </div>
      </div>
    </div>
  </div>
</div>
